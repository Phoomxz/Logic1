<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á‡∏ï‡∏£‡∏£‡∏Å‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Sarabun', sans-serif;
        }
        .formula-builder {
            min-height: 60px;
            border: 2px dashed #d1d5db;
            transition: all 0.3s ease;
        }
        .formula-builder:hover {
            border-color: #3b82f6;
            background-color: #f8fafc;
        }
        .variable-tag {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-900 min-h-screen p-4">
    <div class="max-w-7xl mx-auto">
        <div class="bg-black border border-gray-700 rounded-2xl shadow-xl p-8 mb-8">
            <h1 class="text-4xl font-bold text-center text-white mb-2">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á‡∏ï‡∏£‡∏£‡∏Å‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</h1>
            <p class="text-center text-gray-300 mb-8">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ ‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á</p>
            
            <!-- Variable Management Section -->
            <div class="bg-gray-800 border border-gray-600 rounded-xl p-6 mb-8">
                <h2 class="text-2xl font-semibold text-white mb-4">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£</h2>
                <div class="flex flex-wrap gap-4 items-center mb-4">
                    <div class="flex gap-2">
                        <input type="text" id="newVariable" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ (‡πÄ‡∏ä‡πà‡∏ô P, Q, R)" 
                               class="px-4 py-2 bg-gray-700 border border-gray-500 text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent placeholder-gray-400"
                               maxlength="3">
                        <button onclick="addVariable()" 
                                class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-2 rounded-lg transition duration-200">
                            ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£
                        </button>
                    </div>
                    <button onclick="clearVariables()" 
                            class="bg-red-500 hover:bg-red-600 text-white font-semibold px-4 py-2 rounded-lg transition duration-200">
                        ‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                    </button>
                </div>
                
                <div class="mb-4">
                    <h3 class="text-lg font-semibold text-gray-300 mb-2">‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà:</h3>
                    <div id="variablesList" class="flex flex-wrap gap-2 min-h-[40px] p-3 bg-gray-700 border border-gray-500 rounded-lg">
                        <span class="text-gray-400 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</span>
                    </div>
                </div>
            </div>

            <!-- Formula Builder Section -->
            <div class="bg-gray-800 border border-gray-600 rounded-xl p-6 mb-8">
                <h2 class="text-2xl font-semibold text-white mb-4">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡∏ï‡∏£‡∏£‡∏Å‡∏∞</h2>
                
                <!-- Variable Buttons -->
                <div class="mb-4">
                    <h3 class="text-lg font-semibold text-gray-300 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£:</h3>
                    <div id="variableButtons" class="flex flex-wrap gap-2 mb-4">
                        <span class="text-gray-400 text-sm">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°</span>
                    </div>
                </div>

                <!-- Operator Buttons -->
                <div class="mb-4">
                    <h3 class="text-lg font-semibold text-gray-300 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£:</h3>
                    <div class="flex flex-wrap gap-2 mb-4">
                        <button onclick="addToFormula('‚àß')" 
                                class="bg-blue-500 hover:bg-blue-600 text-white font-semibold px-4 py-2 rounded-lg transition duration-200">
                            ‚àß (‡πÅ‡∏•‡∏∞)
                        </button>
                        <button onclick="addToFormula('‚à®')" 
                                class="bg-green-500 hover:bg-green-600 text-white font-semibold px-4 py-2 rounded-lg transition duration-200">
                            ‚à® (‡∏´‡∏£‡∏∑‡∏≠)
                        </button>
                        <button onclick="addToFormula('¬¨')" 
                                class="bg-red-500 hover:bg-red-600 text-white font-semibold px-4 py-2 rounded-lg transition duration-200">
                            ¬¨ (‡∏ô‡∏¥‡πÄ‡∏™‡∏ò)
                        </button>
                        <button onclick="addToFormula('‚Üí')" 
                                class="bg-purple-500 hover:bg-purple-600 text-white font-semibold px-4 py-2 rounded-lg transition duration-200">
                            ‚Üí (‡∏ñ‡πâ‡∏≤..‡πÅ‡∏•‡πâ‡∏ß)
                        </button>
                        <button onclick="addToFormula('‚Üî')" 
                                class="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold px-4 py-2 rounded-lg transition duration-200">
                            ‚Üî (‡∏Å‡πá‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠)
                        </button>
                        <button onclick="addToFormula('(')" 
                                class="bg-gray-500 hover:bg-gray-600 text-white font-semibold px-4 py-2 rounded-lg transition duration-200">
                            (
                        </button>
                        <button onclick="addToFormula(')')" 
                                class="bg-gray-500 hover:bg-gray-600 text-white font-semibold px-4 py-2 rounded-lg transition duration-200">
                            )
                        </button>
                        <button onclick="clearFormula()" 
                                class="bg-red-500 hover:bg-red-600 text-white font-semibold px-4 py-2 rounded-lg transition duration-200">
                            ‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£
                        </button>
                        <button onclick="undoLastAction()" 
                                class="bg-orange-500 hover:bg-orange-600 text-white font-semibold px-4 py-2 rounded-lg transition duration-200">
                            ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
                        </button>
                    </div>
                </div>

                <!-- Formula Input/Display Section -->
                <div class="mb-4">
                    <h3 class="text-lg font-semibold text-gray-300 mb-2">‡∏™‡∏π‡∏ï‡∏£‡∏ï‡∏£‡∏£‡∏Å‡∏∞:</h3>
                    <div class="mb-2">
                        <textarea id="formulaInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏π‡∏ï‡∏£‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡πÄ‡∏ä‡πà‡∏ô P‚àßQ ‡∏´‡∏£‡∏∑‡∏≠ ¬¨P‚ÜíQ ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á" 
                                  class="w-full px-4 py-3 bg-gray-700 border border-gray-500 text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent placeholder-gray-400 text-lg font-mono resize-none"
                                  rows="3"></textarea>
                    </div>
                    <div class="text-sm text-gray-400 mb-4">
                        <strong>‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ:</strong> ‚àß (‡πÅ‡∏•‡∏∞), ‚à® (‡∏´‡∏£‡∏∑‡∏≠), ¬¨ (‡∏ô‡∏¥‡πÄ‡∏™‡∏ò), ‚Üí (‡∏ñ‡πâ‡∏≤..‡πÅ‡∏•‡πâ‡∏ß), ‚Üî (‡∏Å‡πá‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠), (, ) | <strong>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</strong> P‚àßQ, ¬¨P‚à®Q, (P‚ÜíQ)‚ÜîR
                    </div>
                </div>

                <div class="flex flex-wrap gap-4">
                    <button onclick="generateTruthTable()" 
                            class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-lg transition duration-200 shadow-lg hover:shadow-xl">
                        üîç ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á
                    </button>
                    <button onclick="quickTautologyCheck()" 
                            class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200 shadow-lg hover:shadow-xl">
                        ‚ö° ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏±‡∏à‡∏ô‡∏¥‡∏£‡∏±‡∏ô‡∏î‡∏£‡πå
                    </button>
                    <button onclick="quickContradictionCheck()" 
                            class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200 shadow-lg hover:shadow-xl">
                        ‚ö° ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á
                    </button>
                </div>
            </div>

            <!-- Truth Table Display -->
            <div id="truthTableContainer" class="hidden">
                <h2 class="text-2xl font-semibold text-white mb-4">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á</h2>
                <div class="overflow-x-auto bg-gray-800 border border-gray-600 rounded-xl shadow-lg mb-6">
                    <table id="truthTable" class="w-full border-collapse">
                        <thead id="tableHead" class="bg-black text-white border-b border-gray-600">
                        </thead>
                        <tbody id="tableBody">
                        </tbody>
                    </table>
                </div>
                
                <!-- Result Pattern Display -->
                <div class="bg-gray-800 border border-gray-600 rounded-xl p-6 mb-6">
                    <h3 class="text-xl font-semibold text-white mb-4">üìä ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</h3>
                    <div class="bg-gray-700 rounded-lg p-4 mb-4">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-gray-300 font-medium">‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á:</span>
                            <div id="truthPattern" class="font-mono text-lg"></div>
                        </div>
                        <div class="text-sm text-gray-400">
                            T = ‡∏à‡∏£‡∏¥‡∏á, F = ‡πÄ‡∏ó‡πá‡∏à (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÅ‡∏ñ‡∏ß‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á)
                        </div>
                    </div>
                    <div id="formulaClassification" class="text-center p-4 rounded-lg font-bold text-xl"></div>
                </div>

                <!-- Analysis Section -->
                <div id="analysisSection" class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-gray-800 border-2 border-green-500 rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-green-400 mb-2">üü¢ Tautology (‡∏™‡∏±‡∏à‡∏ô‡∏¥‡∏£‡∏±‡∏ô‡∏î‡∏£‡πå)</h3>
                        <p id="tautologyResult" class="text-green-300 font-medium"></p>
                        <p class="text-sm text-green-400 mt-2">‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏Å‡∏£‡∏ì‡∏µ</p>
                    </div>
                    <div class="bg-gray-800 border-2 border-red-500 rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-red-400 mb-2">üî¥ Contradiction (‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á)</h3>
                        <p id="contradictionResult" class="text-red-300 font-medium"></p>
                        <p class="text-sm text-red-400 mt-2">‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡πá‡∏à‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏Å‡∏£‡∏ì‡∏µ</p>
                    </div>
                    <div class="bg-gray-800 border-2 border-blue-500 rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-blue-400 mb-2">üîµ Contingency (‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ)</h3>
                        <p id="contingencyResult" class="text-blue-300 font-medium"></p>
                        <p class="text-sm text-blue-400 mt-2">‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏à‡∏£‡∏¥‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡πá‡∏à</p>
                    </div>
                </div>
            </div>


        </div>
    </div>

    <script>
        let variables = [];
        let currentFormula = '';
        let formulaHistory = [];

        function addVariable() {
            const input = document.getElementById('newVariable');
            const variableName = input.value.trim().toUpperCase();
            
            if (!variableName) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£');
                return;
            }
            
            if (!/^[A-Z]+$/.test(variableName)) {
                alert('‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
                return;
            }
            
            if (variables.includes(variableName)) {
                alert('‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß');
                return;
            }
            
            variables.push(variableName);
            input.value = '';
            updateVariablesDisplay();
            updateVariableButtons();
        }

        function clearVariables() {
            variables = [];
            formulaHistory = [];
            document.getElementById('formulaInput').value = '';
            updateVariablesDisplay();
            updateVariableButtons();
            document.getElementById('truthTableContainer').classList.add('hidden');
        }

        function updateVariablesDisplay() {
            const container = document.getElementById('variablesList');
            if (variables.length === 0) {
                container.innerHTML = '<span class="text-gray-400 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</span>';
            } else {
                container.innerHTML = variables.map(variable => 
                    `<span class="variable-tag bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-semibold">
                        ${variable}
                        <button onclick="removeVariable('${variable}')" class="ml-2 text-blue-600 hover:text-blue-800">√ó</button>
                    </span>`
                ).join('');
            }
        }

        function updateVariableButtons() {
            const container = document.getElementById('variableButtons');
            if (variables.length === 0) {
                container.innerHTML = '<span class="text-gray-400 text-sm">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°</span>';
            } else {
                container.innerHTML = variables.map(variable => 
                    `<button onclick="addToFormula('${variable}')" 
                             class="bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-4 py-2 rounded-lg transition duration-200">
                        ${variable}
                    </button>`
                ).join('');
            }
        }

        function removeVariable(variableName) {
            variables = variables.filter(v => v !== variableName);
            // Remove from current formula if exists
            const input = document.getElementById('formulaInput');
            input.value = input.value.replace(new RegExp(`\\b${variableName}\\b`, 'g'), '').replace(/\s+/g, ' ').trim();
            updateVariablesDisplay();
            updateVariableButtons();
        }

        function addToFormula(text) {
            const input = document.getElementById('formulaInput');
            const currentPos = input.selectionStart;
            const currentValue = input.value;
            
            formulaHistory.push(currentValue);
            const newValue = currentValue.slice(0, currentPos) + text + currentValue.slice(currentPos);
            input.value = newValue;
            
            // Set cursor position after inserted text
            const newPos = currentPos + text.length;
            input.setSelectionRange(newPos, newPos);
            input.focus();
        }

        function clearFormula() {
            const input = document.getElementById('formulaInput');
            formulaHistory.push(input.value);
            input.value = '';
            input.focus();
        }

        function undoLastAction() {
            if (formulaHistory.length > 0) {
                const input = document.getElementById('formulaInput');
                input.value = formulaHistory.pop();
                input.focus();
            }
        }

        function getCurrentFormula() {
            return document.getElementById('formulaInput').value.trim();
        }



        function parseVariables(variableArray) {
            return variableArray;
        }

        function generateCombinations(variables) {
            const n = variables.length;
            const combinations = [];
            
            for (let i = 0; i < Math.pow(2, n); i++) {
                const combination = {};
                for (let j = 0; j < n; j++) {
                    combination[variables[j]] = Boolean(i & (1 << (n - 1 - j)));
                }
                combinations.push(combination);
            }
            
            return combinations;
        }

        function parseFormulaSteps(formula) {
            // Parse the formula to identify sub-expressions and their evaluation order
            const steps = [];
            let currentFormula = formula;
            
            // Find all sub-expressions (variables, negations, binary operations)
            const findSubExpressions = (expr) => {
                const subExprs = new Set();
                
                // Add individual variables
                const variables = expr.match(/\b[A-Z]+\b/g) || [];
                variables.forEach(v => subExprs.add(v));
                
                // Add negations
                const negations = expr.match(/¬¨[A-Z]+/g) || [];
                negations.forEach(n => subExprs.add(n));
                
                // Add parenthesized expressions
                let depth = 0;
                let start = -1;
                for (let i = 0; i < expr.length; i++) {
                    if (expr[i] === '(') {
                        if (depth === 0) start = i;
                        depth++;
                    } else if (expr[i] === ')') {
                        depth--;
                        if (depth === 0 && start !== -1) {
                            const parenExpr = expr.substring(start + 1, i);
                            if (parenExpr.match(/[‚àß‚à®‚Üí‚Üî]/)) {
                                subExprs.add(parenExpr);
                            }
                        }
                    }
                }
                
                // Add binary operations (without parentheses)
                const binaryOps = ['‚Üî', '‚Üí', '‚à®', '‚àß'];
                for (const op of binaryOps) {
                    const regex = new RegExp(`([^()]+)\\${op}([^()]+)`, 'g');
                    let match;
                    while ((match = regex.exec(expr)) !== null) {
                        const fullExpr = match[0].trim();
                        if (!fullExpr.includes('(') && !fullExpr.includes(')')) {
                            subExprs.add(fullExpr);
                        }
                    }
                }
                
                return Array.from(subExprs).sort((a, b) => {
                    // Sort by complexity (variables first, then simple operations, then complex)
                    if (a.match(/^[A-Z]+$/) && !b.match(/^[A-Z]+$/)) return -1;
                    if (!a.match(/^[A-Z]+$/) && b.match(/^[A-Z]+$/)) return 1;
                    if (a.startsWith('¬¨') && !b.startsWith('¬¨')) return -1;
                    if (!a.startsWith('¬¨') && b.startsWith('¬¨')) return 1;
                    return a.length - b.length;
                });
            };
            
            return findSubExpressions(formula);
        }

        function evaluateFormula(formula, values) {
            try {
                // Replace logical symbols with JavaScript equivalents
                let jsFormula = formula
                    .replace(/‚àß/g, '&&')
                    .replace(/‚à®/g, '||')
                    .replace(/¬¨/g, '!')
                    .replace(/‚Üí/g, '? true :')
                    .replace(/‚Üî/g, '===')
                    // Also support Thai text for backward compatibility
                    .replace(/\b‡πÅ‡∏•‡∏∞\b/g, '&&')
                    .replace(/\b‡∏´‡∏£‡∏∑‡∏≠\b/g, '||')
                    .replace(/\b‡∏ô‡∏¥‡πÄ‡∏™‡∏ò\b/g, '!')
                    .replace(/\b‡∏ñ‡πâ‡∏≤\.\.‡πÅ‡∏•‡πâ‡∏ß\b/g, '? true :')
                    .replace(/\b‡∏Å‡πá‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠\b/g, '===');

                // Handle IMPLIES operator properly
                jsFormula = jsFormula.replace(/([^?]+)\s*\?\s*true\s*:\s*([^?]+)/g, '(!($1) || ($2))');

                // Replace variables with their values
                for (const [variable, value] of Object.entries(values)) {
                    const regex = new RegExp(`\\b${variable}\\b`, 'g');
                    jsFormula = jsFormula.replace(regex, value.toString());
                }

                // Evaluate the formula
                return eval(jsFormula);
            } catch (error) {
                throw new Error('‡∏™‡∏π‡∏ï‡∏£‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ' + error.message);
            }
        }

        function evaluateSubExpression(expr, values) {
            try {
                return evaluateFormula(expr, values);
            } catch (error) {
                return null;
            }
        }

        function generateTruthTable() {
            if (variables.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }

            const currentFormula = getCurrentFormula();
            if (!currentFormula) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }

            // Validate that all variables in the formula exist
            const usedVariables = currentFormula.match(/\b[A-Z]+\b/g) || [];
            const missingVariables = usedVariables.filter(v => !variables.includes(v));
            
            if (missingVariables.length > 0) {
                alert(`‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°: ${missingVariables.join(', ')}\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏™‡∏π‡∏ï‡∏£`);
                return;
            }

            // Basic validation for logical symbols
            const validSymbols = ['‚àß', '‚à®', '¬¨', '‚Üí', '‚Üî', '(', ')'];
            const invalidChars = currentFormula.split('').filter(char => 
                !char.match(/[A-Z\s]/) && !validSymbols.includes(char)
            );
            
            if (invalidChars.length > 0) {
                alert(`‡∏û‡∏ö‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö: ${[...new Set(invalidChars)].join(', ')}\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏ï‡∏£‡∏£‡∏Å‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î`);
                return;
            }

            try {
                const combinations = generateCombinations(variables);
                const subExpressions = parseFormulaSteps(currentFormula);
                
                // Create table header
                const tableHead = document.getElementById('tableHead');
                const tableBody = document.getElementById('tableBody');
                
                tableHead.innerHTML = '';
                tableBody.innerHTML = '';

                const headerRow = document.createElement('tr');
                
                // Add variable columns
                variables.forEach(variable => {
                    const th = document.createElement('th');
                    th.textContent = variable;
                    th.className = 'px-4 py-3 text-center font-semibold border-r border-gray-600 bg-gray-700';
                    headerRow.appendChild(th);
                });

                // Add sub-expression columns
                subExpressions.forEach((subExpr, index) => {
                    if (!variables.includes(subExpr)) { // Don't duplicate variable columns
                        const th = document.createElement('th');
                        th.textContent = subExpr;
                        th.className = 'px-3 py-3 text-center font-semibold border-r border-gray-600 bg-gray-600 text-sm';
                        headerRow.appendChild(th);
                    }
                });

                // Add final formula column only if it's different from existing columns
                const shouldShowFinalColumn = !variables.includes(currentFormula) && !subExpressions.includes(currentFormula);
                if (shouldShowFinalColumn) {
                    const formulaTh = document.createElement('th');
                    formulaTh.textContent = currentFormula;
                    formulaTh.className = 'px-4 py-3 text-center font-semibold bg-blue-700 text-sm';
                    headerRow.appendChild(formulaTh);
                }

                tableHead.appendChild(headerRow);

                // Generate table rows
                let allTrue = true;
                let allFalse = true;
                let truthValues = [];

                combinations.forEach((combination, index) => {
                    const row = document.createElement('tr');
                    row.className = index % 2 === 0 ? 'bg-gray-50' : 'bg-white';

                    // Add variable values
                    variables.forEach((variable, varIndex) => {
                        const td = document.createElement('td');
                        const value = combination[variable];
                        td.textContent = value ? 'T' : 'F';
                        td.className = `px-4 py-3 text-center font-medium ${value ? 'text-green-600' : 'text-red-600'} ${varIndex < variables.length - 1 ? 'border-r border-gray-200' : ''} border-r border-gray-200`;
                        row.appendChild(td);
                    });

                    // Add sub-expression values
                    subExpressions.forEach((subExpr, subIndex) => {
                        if (!variables.includes(subExpr)) { // Don't duplicate variable columns
                            const td = document.createElement('td');
                            const result = evaluateSubExpression(subExpr, combination);
                            td.textContent = result ? 'T' : 'F';
                            td.className = `px-3 py-3 text-center font-medium ${result ? 'text-blue-600' : 'text-orange-600'} border-r border-gray-200 bg-gray-50`;
                            row.appendChild(td);
                        }
                    });

                    // Calculate and add final formula result only if column was added
                    const finalResult = evaluateFormula(currentFormula, combination);
                    if (shouldShowFinalColumn) {
                        const resultTd = document.createElement('td');
                        resultTd.textContent = finalResult ? 'T' : 'F';
                        resultTd.className = `px-4 py-3 text-center font-bold text-lg ${finalResult ? 'text-green-600 bg-green-50' : 'text-red-600 bg-red-50'} border-l-2 ${finalResult ? 'border-green-300' : 'border-red-300'}`;
                        row.appendChild(resultTd);
                    }

                    tableBody.appendChild(row);

                    // Track for analysis - use the final result regardless of column display
                    truthValues.push(finalResult ? 'T' : 'F');
                    if (!finalResult) allTrue = false;
                    if (finalResult) allFalse = false;
                });

                // Display truth pattern
                const truthPattern = truthValues.join(' ');
                document.getElementById('truthPattern').innerHTML = truthPattern.split('').map(char => 
                    char === 'T' ? `<span class="text-green-400">${char}</span>` : 
                    char === 'F' ? `<span class="text-red-400">${char}</span>` : char
                ).join('');

                // Display formula classification
                const classificationDiv = document.getElementById('formulaClassification');
                if (allTrue) {
                    classificationDiv.textContent = 'üü¢ ‡∏™‡∏π‡∏ï‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô TAUTOLOGY (‡∏™‡∏±‡∏à‡∏ô‡∏¥‡∏£‡∏±‡∏ô‡∏î‡∏£‡πå)';
                    classificationDiv.className = 'text-center p-4 rounded-lg font-bold text-xl bg-green-700 text-green-100 border-2 border-green-500';
                } else if (allFalse) {
                    classificationDiv.textContent = 'üî¥ ‡∏™‡∏π‡∏ï‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô CONTRADICTION (‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á)';
                    classificationDiv.className = 'text-center p-4 rounded-lg font-bold text-xl bg-red-700 text-red-100 border-2 border-red-500';
                } else {
                    classificationDiv.textContent = 'üîµ ‡∏™‡∏π‡∏ï‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô CONTINGENCY (‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ)';
                    classificationDiv.className = 'text-center p-4 rounded-lg font-bold text-xl bg-blue-700 text-blue-100 border-2 border-blue-500';
                }

                // Show analysis
                document.getElementById('tautologyResult').textContent = allTrue ? '‡πÉ‡∏ä‡πà - ‡∏™‡∏π‡∏ï‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏±‡∏à‡∏ô‡∏¥‡∏£‡∏±‡∏ô‡∏î‡∏£‡πå' : '‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà';
                document.getElementById('contradictionResult').textContent = allFalse ? '‡πÉ‡∏ä‡πà - ‡∏™‡∏π‡∏ï‡∏£‡∏ô‡∏µ‡πâ‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á' : '‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà';
                document.getElementById('contingencyResult').textContent = (!allTrue && !allFalse) ? '‡πÉ‡∏ä‡πà - ‡∏™‡∏π‡∏ï‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ' : '‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà';

                // Show the truth table
                document.getElementById('truthTableContainer').classList.remove('hidden');
                
                // Scroll to results
                document.getElementById('truthTableContainer').scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            }
        }

        function quickTautologyCheck() {
            if (variables.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }

            const currentFormula = getCurrentFormula();
            if (!currentFormula) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }

            // Validate that all variables in the formula exist
            const usedVariables = currentFormula.match(/\b[A-Z]+\b/g) || [];
            const missingVariables = usedVariables.filter(v => !variables.includes(v));
            
            if (missingVariables.length > 0) {
                alert(`‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°: ${missingVariables.join(', ')}\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏™‡∏π‡∏ï‡∏£`);
                return;
            }

            try {
                const combinations = generateCombinations(variables);
                let allTrue = true;

                for (const combination of combinations) {
                    const result = evaluateFormula(currentFormula, combination);
                    if (!result) {
                        allTrue = false;
                        break;
                    }
                }

                if (allTrue) {
                    alert(`‚úÖ ‡∏™‡∏π‡∏ï‡∏£ "${currentFormula}" ‡πÄ‡∏õ‡πá‡∏ô TAUTOLOGY (‡∏™‡∏±‡∏à‡∏ô‡∏¥‡∏£‡∏±‡∏ô‡∏î‡∏£‡πå)\n\n‡∏™‡∏π‡∏ï‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏Å‡∏£‡∏ì‡∏µ!`);
                } else {
                    alert(`‚ùå ‡∏™‡∏π‡∏ï‡∏£ "${currentFormula}" ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà TAUTOLOGY\n\n‡∏™‡∏π‡∏ï‡∏£‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡πá‡∏à`);
                }
            } catch (error) {
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            }
        }

        function quickContradictionCheck() {
            if (variables.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }

            const currentFormula = getCurrentFormula();
            if (!currentFormula) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }

            // Validate that all variables in the formula exist
            const usedVariables = currentFormula.match(/\b[A-Z]+\b/g) || [];
            const missingVariables = usedVariables.filter(v => !variables.includes(v));
            
            if (missingVariables.length > 0) {
                alert(`‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°: ${missingVariables.join(', ')}\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏™‡∏π‡∏ï‡∏£`);
                return;
            }

            try {
                const combinations = generateCombinations(variables);
                let allFalse = true;

                for (const combination of combinations) {
                    const result = evaluateFormula(currentFormula, combination);
                    if (result) {
                        allFalse = false;
                        break;
                    }
                }

                if (allFalse) {
                    alert(`‚úÖ ‡∏™‡∏π‡∏ï‡∏£ "${currentFormula}" ‡πÄ‡∏õ‡πá‡∏ô CONTRADICTION (‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á)\n\n‡∏™‡∏π‡∏ï‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡πá‡∏à‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏Å‡∏£‡∏ì‡∏µ!`);
                } else {
                    alert(`‚ùå ‡∏™‡∏π‡∏ï‡∏£ "${currentFormula}" ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà CONTRADICTION\n\n‡∏™‡∏π‡∏ï‡∏£‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏£‡∏¥‡∏á`);
                }
            } catch (error) {
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            }
        }

        // Allow Enter key to add variable
        document.getElementById('newVariable').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addVariable();
            }
        });

        // Initialize with some example variables
        window.onload = function() {
            // You can uncomment these lines to start with some default variables
            // variables = ['P', 'Q'];
            // updateVariablesDisplay();
            // updateVariableButtons();
        };
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96a4f1aee7dad033',t:'MTc1NDM4Mjc0OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
